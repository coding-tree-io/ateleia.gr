---
import { DancingFigures, HandCircle } from '@/components/decorative/ArtShapes';
import { ParallaxLayer } from '@/components/decorative/ParallaxLayer';
import { Badge } from '@/components/ui/badge';
import { ResourcesFilters } from '@/components/sections/ResourcesFilters';
import { collectSortedResourceTags, createResourceSearchText, createResourceTagsSearchText } from '@/content/resource-utils';
import { therapyPracticeWebsiteContent } from '@/content/therapy-practice-website-content';

const {
  resources: {
    title: resourcesSectionTitle,
    subtitle: resourcesSectionSubtitle,
    items: curatedResourceItems,
  },
} = therapyPracticeWebsiteContent;

const availableResourceTags = collectSortedResourceTags(curatedResourceItems);
const resourcesSectionRootElementId = 'resources-section-root';
---

<section id="resources" class="relative overflow-hidden px-4 py-16 sm:px-6 sm:py-20 md:px-10 md:py-28">
  <ParallaxLayer
    speed={0.18}
    className="absolute -left-14 bottom-[-10%] w-[280px] opacity-45 md:-left-20 md:bottom-[-12%] md:w-[620px] md:opacity-100"
  >
    <DancingFigures />
  </ParallaxLayer>
  <ParallaxLayer
    speed={0.25}
    className="absolute right-[6%] top-[6%] w-14 opacity-55 md:right-[8%] md:top-[8%] md:w-24 md:opacity-100"
  >
    <HandCircle />
  </ParallaxLayer>

  <div id={resourcesSectionRootElementId} class="relative z-10 mx-auto max-w-6xl">
    <h2 class="font-serif text-3xl font-bold leading-tight text-balance text-foreground md:text-4xl lg:text-5xl">
      {resourcesSectionTitle}
    </h2>
    <p class="mt-4 max-w-3xl text-base leading-relaxed text-muted-foreground md:text-lg">
      {resourcesSectionSubtitle}
    </p>

    <ResourcesFilters
      client:visible={{ rootMargin: '220px' }}
      sectionRootElementId={resourcesSectionRootElementId}
      availableTags={availableResourceTags}
      allTagsLabel="Όλα"
      searchPlaceholder="Αναζήτηση..."
      searchInputLabel="Αναζήτηση πόρων"
    />

    <div class="mt-10 grid gap-5 sm:grid-cols-2 lg:grid-cols-3" data-resource-card-grid>
      {
        curatedResourceItems.map((resourceItem) => (
          <a
            href={resourceItem.url}
            target="_blank"
            rel="noopener noreferrer"
            class="group paper-panel flex min-h-52 flex-col justify-between rounded-2xl border border-border/45 p-6 transition-all duration-500 hover:-translate-y-1 hover:shadow-lg"
            data-resource-card
            data-resource-search-text={createResourceSearchText(resourceItem)}
            data-resource-tags={createResourceTagsSearchText(resourceItem)}
          >
            <div>
              <div class="flex items-start justify-between gap-3">
                <h3 class="break-words font-sans text-sm font-bold leading-snug text-foreground transition-colors duration-300 group-hover:text-primary">
                  {resourceItem.title}
                </h3>
                <span class="mt-0.5 text-muted-foreground/60" aria-hidden="true">
                  ↗
                </span>
              </div>
              <p class="mt-1.5 text-xs font-semibold text-[var(--tone-teal)]">{resourceItem.source}</p>
              <p class="mt-3 text-sm leading-relaxed text-muted-foreground">{resourceItem.note}</p>
            </div>

            <div class="mt-5 flex flex-wrap gap-1.5">
              {
                resourceItem.tags.map((resourceTag) => (
                  <Badge
                    variant="secondary"
                    className="rounded-full border border-border/35 text-[10px] font-semibold"
                  >
                    {resourceTag}
                  </Badge>
                ))
              }
            </div>
          </a>
        ))
      }
    </div>

    <p data-resource-empty-state hidden class="mt-10 text-center text-sm text-muted-foreground">
      Δεν βρέθηκαν αποτελέσματα. Δοκιμάστε διαφορετική αναζήτηση.
    </p>
  </div>
</section>
